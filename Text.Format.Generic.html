<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Format.Generic</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Format strings for Printf and Scanf</a>
<a id="145" class="Comment">------------------------------------------------------------------------</a>

<a id="219" class="Symbol">{-#</a> <a id="223" class="Keyword">OPTIONS</a> <a id="231" class="Pragma">--without-K</a> <a id="243" class="Pragma">--safe</a> <a id="250" class="Symbol">#-}</a>

<a id="255" class="Keyword">open</a> <a id="260" class="Keyword">import</a> <a id="267" href="Data.Char.Base.html" class="Module">Data.Char.Base</a> <a id="282" class="Keyword">using</a> <a id="288" class="Symbol">(</a><a id="289" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a><a id="293" class="Symbol">)</a>
<a id="295" class="Keyword">open</a> <a id="300" class="Keyword">import</a> <a id="307" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="323" class="Keyword">using</a> <a id="329" class="Symbol">(</a><a id="330" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a><a id="335" class="Symbol">)</a>

<a id="338" class="Keyword">module</a> <a id="345" href="Text.Format.Generic.html" class="Module">Text.Format.Generic</a> <a id="365" class="Keyword">where</a>

<a id="372" class="Keyword">open</a> <a id="377" class="Keyword">import</a> <a id="384" href="Level.html" class="Module">Level</a> <a id="390" class="Keyword">using</a> <a id="396" class="Symbol">(</a><a id="397" href="Level.html#512" class="Function">0ℓ</a><a id="399" class="Symbol">)</a>
<a id="401" class="Keyword">open</a> <a id="406" class="Keyword">import</a> <a id="413" href="Effect.Applicative.html" class="Module">Effect.Applicative</a>
<a id="432" class="Keyword">open</a> <a id="437" class="Keyword">import</a> <a id="444" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="459" class="Symbol">as</a> <a id="462" class="Module">List</a>
<a id="467" class="Keyword">open</a> <a id="472" class="Keyword">import</a> <a id="479" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="490" class="Symbol">as</a> <a id="493" class="Module">Maybe</a>
<a id="499" class="Keyword">open</a> <a id="504" class="Keyword">import</a> <a id="511" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="525" class="Keyword">open</a> <a id="530" class="Keyword">import</a> <a id="537" href="Data.Product.html" class="Module">Data.Product</a>
<a id="550" class="Keyword">open</a> <a id="555" class="Keyword">import</a> <a id="562" href="Data.Product.Nary.NonDependent.html" class="Module">Data.Product.Nary.NonDependent</a>
<a id="593" class="Keyword">open</a> <a id="598" class="Keyword">import</a> <a id="605" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a>
<a id="619" class="Keyword">open</a> <a id="624" class="Keyword">import</a> <a id="631" href="Data.String.Base.html" class="Module">Data.String.Base</a>
<a id="648" class="Keyword">import</a> <a id="655" href="Data.Sum.Effectful.Left.html" class="Module">Data.Sum.Effectful.Left</a> <a id="679" class="Symbol">as</a> <a id="682" class="Module">Sumₗ</a>
<a id="687" class="Keyword">open</a> <a id="692" class="Keyword">import</a> <a id="699" href="Function.html" class="Module">Function</a>
<a id="708" class="Keyword">open</a> <a id="713" class="Keyword">import</a> <a id="720" href="Function.Nary.NonDependent.html" class="Module">Function.Nary.NonDependent</a> <a id="747" class="Keyword">using</a> <a id="753" class="Symbol">(</a><a id="754" href="Function.Nary.NonDependent.html#1531" class="Function">0ℓs</a><a id="757" class="Symbol">;</a> <a id="759" href="Function.Nary.NonDependent.Base.html#2330" class="Function">Sets</a><a id="763" class="Symbol">)</a>
<a id="765" class="Keyword">open</a> <a id="770" class="Keyword">import</a> <a id="777" href="Function.Strict.html" class="Module">Function.Strict</a>

<a id="794" class="Comment">------------------------------------------------------------------------</a>
<a id="867" class="Comment">-- Format specifications.</a>
<a id="893" class="Comment">-- Defines the supported %-codes.</a>

<a id="928" class="Keyword">record</a> <a id="FormatSpec"></a><a id="935" href="Text.Format.Generic.html#935" class="Record">FormatSpec</a> <a id="946" class="Symbol">:</a> <a id="948" href="Agda.Primitive.html#326" class="Primitive">Set₁</a> <a id="953" class="Keyword">where</a>
  <a id="961" class="Keyword">field</a>
    <a id="FormatSpec.ArgChunk"></a><a id="971" href="Text.Format.Generic.html#971" class="Field">ArgChunk</a> <a id="980" class="Symbol">:</a> <a id="982" href="Agda.Primitive.html#326" class="Primitive">Set</a>
    <a id="FormatSpec.ArgType"></a><a id="990" href="Text.Format.Generic.html#990" class="Field">ArgType</a>  <a id="999" class="Symbol">:</a> <a id="1001" href="Text.Format.Generic.html#971" class="Field">ArgChunk</a> <a id="1010" class="Symbol">→</a> <a id="1012" href="Agda.Primitive.html#326" class="Primitive">Set</a>
    <a id="FormatSpec.lexArg"></a><a id="1020" href="Text.Format.Generic.html#1020" class="Field">lexArg</a>   <a id="1029" class="Symbol">:</a> <a id="1031" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="1036" class="Symbol">→</a> <a id="1038" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="1044" href="Text.Format.Generic.html#971" class="Field">ArgChunk</a>

<a id="1054" class="Keyword">module</a> <a id="1061" href="Text.Format.Generic.html#1061" class="Module">_</a> <a id="1063" class="Keyword">where</a>
  <a id="1071" class="Keyword">open</a> <a id="1076" href="Text.Format.Generic.html#935" class="Module">FormatSpec</a>

  <a id="1090" class="Comment">-- Left-biased union of format specs.</a>
  <a id="1130" href="Text.Format.Generic.html#1130" class="Function">unionSpec</a> <a id="1140" class="Symbol">:</a> <a id="1142" href="Text.Format.Generic.html#935" class="Record">FormatSpec</a> <a id="1153" class="Symbol">→</a> <a id="1155" href="Text.Format.Generic.html#935" class="Record">FormatSpec</a> <a id="1166" class="Symbol">→</a> <a id="1168" href="Text.Format.Generic.html#935" class="Record">FormatSpec</a>
  <a id="1181" href="Text.Format.Generic.html#1130" class="Function">unionSpec</a> <a id="1191" href="Text.Format.Generic.html#1191" class="Bound">spec₁</a> <a id="1197" href="Text.Format.Generic.html#1197" class="Bound">spec₂</a> <a id="1203" class="Symbol">.</a><a id="1204" href="Text.Format.Generic.html#971" class="Field">ArgChunk</a>  <a id="1214" class="Symbol">=</a> <a id="1216" href="Text.Format.Generic.html#1191" class="Bound">spec₁</a> <a id="1222" class="Symbol">.</a><a id="1223" href="Text.Format.Generic.html#971" class="Field">ArgChunk</a> <a id="1232" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="1234" href="Text.Format.Generic.html#1197" class="Bound">spec₂</a> <a id="1240" class="Symbol">.</a><a id="1241" href="Text.Format.Generic.html#971" class="Field">ArgChunk</a>
  <a id="1252" href="Text.Format.Generic.html#1130" class="Function">unionSpec</a> <a id="1262" href="Text.Format.Generic.html#1262" class="Bound">spec₁</a> <a id="1268" href="Text.Format.Generic.html#1268" class="Bound">spec₂</a> <a id="1274" class="Symbol">.</a><a id="1275" href="Text.Format.Generic.html#990" class="Field">ArgType</a> <a id="1283" class="Symbol">(</a><a id="1284" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="1289" href="Text.Format.Generic.html#1289" class="Bound">a</a><a id="1290" class="Symbol">)</a> <a id="1292" class="Symbol">=</a> <a id="1294" href="Text.Format.Generic.html#1262" class="Bound">spec₁</a> <a id="1300" class="Symbol">.</a><a id="1301" href="Text.Format.Generic.html#990" class="Field">ArgType</a> <a id="1309" href="Text.Format.Generic.html#1289" class="Bound">a</a>
  <a id="1313" href="Text.Format.Generic.html#1130" class="Function">unionSpec</a> <a id="1323" href="Text.Format.Generic.html#1323" class="Bound">spec₁</a> <a id="1329" href="Text.Format.Generic.html#1329" class="Bound">spec₂</a> <a id="1335" class="Symbol">.</a><a id="1336" href="Text.Format.Generic.html#990" class="Field">ArgType</a> <a id="1344" class="Symbol">(</a><a id="1345" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="1350" href="Text.Format.Generic.html#1350" class="Bound">a</a><a id="1351" class="Symbol">)</a> <a id="1353" class="Symbol">=</a> <a id="1355" href="Text.Format.Generic.html#1329" class="Bound">spec₂</a> <a id="1361" class="Symbol">.</a><a id="1362" href="Text.Format.Generic.html#990" class="Field">ArgType</a> <a id="1370" href="Text.Format.Generic.html#1350" class="Bound">a</a>
  <a id="1374" href="Text.Format.Generic.html#1130" class="Function">unionSpec</a> <a id="1384" href="Text.Format.Generic.html#1384" class="Bound">spec₁</a> <a id="1390" href="Text.Format.Generic.html#1390" class="Bound">spec₂</a> <a id="1396" class="Symbol">.</a><a id="1397" href="Text.Format.Generic.html#1020" class="Field">lexArg</a>  <a id="1405" href="Text.Format.Generic.html#1405" class="Bound">c</a> <a id="1407" class="Symbol">=</a>
    <a id="1413" href="Data.Maybe.Base.html#2020" class="Function">Maybe.map</a> <a id="1423" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="1428" class="Symbol">(</a><a id="1429" href="Text.Format.Generic.html#1384" class="Bound">spec₁</a> <a id="1435" class="Symbol">.</a><a id="1436" href="Text.Format.Generic.html#1020" class="Field">lexArg</a> <a id="1443" href="Text.Format.Generic.html#1405" class="Bound">c</a><a id="1444" class="Symbol">)</a> <a id="1446" href="Data.Maybe.Base.html#2335" class="Function Operator">&lt;∣&gt;</a>
    <a id="1454" href="Data.Maybe.Base.html#2020" class="Function">Maybe.map</a> <a id="1464" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="1469" class="Symbol">(</a><a id="1470" href="Text.Format.Generic.html#1390" class="Bound">spec₂</a> <a id="1476" class="Symbol">.</a><a id="1477" href="Text.Format.Generic.html#1020" class="Field">lexArg</a> <a id="1484" href="Text.Format.Generic.html#1405" class="Bound">c</a><a id="1485" class="Symbol">)</a>

<a id="1488" class="Keyword">module</a> <a id="Format"></a><a id="1495" href="Text.Format.Generic.html#1495" class="Module">Format</a> <a id="1502" class="Symbol">(</a><a id="1503" href="Text.Format.Generic.html#1503" class="Bound">spec</a> <a id="1508" class="Symbol">:</a> <a id="1510" href="Text.Format.Generic.html#935" class="Record">FormatSpec</a><a id="1520" class="Symbol">)</a> <a id="1522" class="Keyword">where</a>

  <a id="1531" class="Keyword">open</a> <a id="1536" href="Text.Format.Generic.html#935" class="Module">FormatSpec</a> <a id="1547" href="Text.Format.Generic.html#1503" class="Bound">spec</a>

  <a id="1555" class="Comment">------------------------------------------------------------------------</a>
  <a id="1630" class="Comment">-- Basic types</a>

  <a id="1648" class="Keyword">data</a> <a id="Format.Chunk"></a><a id="1653" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a> <a id="1659" class="Symbol">:</a> <a id="1661" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1665" class="Keyword">where</a>
    <a id="Format.Chunk.Arg"></a><a id="1675" href="Text.Format.Generic.html#1675" class="InductiveConstructor">Arg</a> <a id="1679" class="Symbol">:</a> <a id="1681" href="Text.Format.Generic.html#971" class="Field">ArgChunk</a> <a id="1690" class="Symbol">→</a> <a id="1692" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a>
    <a id="Format.Chunk.Raw"></a><a id="1702" href="Text.Format.Generic.html#1702" class="InductiveConstructor">Raw</a> <a id="1706" class="Symbol">:</a> <a id="1708" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="1715" class="Symbol">→</a> <a id="1717" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a>

  <a id="Format.Format"></a><a id="1726" href="Text.Format.Generic.html#1726" class="Function">Format</a> <a id="1733" class="Symbol">:</a> <a id="1735" href="Agda.Primitive.html#326" class="Primitive">Set</a>
  <a id="1741" href="Text.Format.Generic.html#1726" class="Function">Format</a> <a id="1748" class="Symbol">=</a> <a id="1750" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1755" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a>

  <a id="1764" class="Comment">------------------------------------------------------------------------</a>
  <a id="1839" class="Comment">-- Semantics</a>

  <a id="Format.size"></a><a id="1855" href="Text.Format.Generic.html#1855" class="Function">size</a> <a id="1860" class="Symbol">:</a> <a id="1862" href="Text.Format.Generic.html#1726" class="Function">Format</a> <a id="1869" class="Symbol">→</a> <a id="1871" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="1875" href="Text.Format.Generic.html#1855" class="Function">size</a> <a id="1880" class="Symbol">=</a> <a id="1882" href="Data.List.Base.html#4799" class="Function">List.sum</a> <a id="1891" href="Function.Base.html#3637" class="Function Operator">∘′</a> <a id="1894" href="Data.List.Base.html#1563" class="Function">List.map</a> <a id="1903" class="Symbol">λ</a> <a id="1905" class="Symbol">{</a> <a id="1907" class="Symbol">(</a><a id="1908" href="Text.Format.Generic.html#1702" class="InductiveConstructor">Raw</a> <a id="1912" class="Symbol">_)</a> <a id="1915" class="Symbol">→</a> <a id="1917" class="Number">0</a><a id="1918" class="Symbol">;</a> <a id="1920" class="CatchallClause Symbol">_</a> <a id="1922" class="Symbol">→</a> <a id="1924" class="Number">1</a> <a id="1926" class="Symbol">}</a>

  <a id="1931" class="Comment">-- Meaning of a format as a list of value types</a>

  <a id="Format.⟦_⟧"></a><a id="1982" href="Text.Format.Generic.html#1982" class="Function Operator">⟦_⟧</a> <a id="1986" class="Symbol">:</a> <a id="1988" class="Symbol">(</a><a id="1989" href="Text.Format.Generic.html#1989" class="Bound">fmt</a> <a id="1993" class="Symbol">:</a> <a id="1995" href="Text.Format.Generic.html#1726" class="Function">Format</a><a id="2001" class="Symbol">)</a> <a id="2003" class="Symbol">→</a> <a id="2005" href="Function.Nary.NonDependent.Base.html#2330" class="Function">Sets</a> <a id="2010" class="Symbol">(</a><a id="2011" href="Text.Format.Generic.html#1855" class="Function">size</a> <a id="2016" href="Text.Format.Generic.html#1989" class="Bound">fmt</a><a id="2019" class="Symbol">)</a> <a id="2021" href="Function.Nary.NonDependent.html#1531" class="Function">0ℓs</a>
  <a id="2027" href="Text.Format.Generic.html#1982" class="Function Operator">⟦</a> <a id="2029" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>          <a id="2041" href="Text.Format.Generic.html#1982" class="Function Operator">⟧</a> <a id="2043" class="Symbol">=</a> <a id="2045" class="Symbol">_</a>
  <a id="2049" href="Text.Format.Generic.html#1982" class="Function Operator">⟦</a> <a id="2051" href="Text.Format.Generic.html#1675" class="InductiveConstructor">Arg</a> <a id="2055" href="Text.Format.Generic.html#2055" class="Bound">a</a>  <a id="2058" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2060" href="Text.Format.Generic.html#2060" class="Bound">cs</a> <a id="2063" href="Text.Format.Generic.html#1982" class="Function Operator">⟧</a> <a id="2065" class="Symbol">=</a> <a id="2067" href="Text.Format.Generic.html#990" class="Field">ArgType</a> <a id="2075" href="Text.Format.Generic.html#2055" class="Bound">a</a> <a id="2077" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2079" href="Text.Format.Generic.html#1982" class="Function Operator">⟦</a> <a id="2081" href="Text.Format.Generic.html#2060" class="Bound">cs</a> <a id="2084" href="Text.Format.Generic.html#1982" class="Function Operator">⟧</a>
  <a id="2088" href="Text.Format.Generic.html#1982" class="Function Operator">⟦</a> <a id="2090" href="Text.Format.Generic.html#1702" class="InductiveConstructor">Raw</a> <a id="2094" class="Symbol">_</a>  <a id="2097" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2099" href="Text.Format.Generic.html#2099" class="Bound">cs</a> <a id="2102" href="Text.Format.Generic.html#1982" class="Function Operator">⟧</a> <a id="2104" class="Symbol">=</a>             <a id="2118" href="Text.Format.Generic.html#1982" class="Function Operator">⟦</a> <a id="2120" href="Text.Format.Generic.html#2099" class="Bound">cs</a> <a id="2123" href="Text.Format.Generic.html#1982" class="Function Operator">⟧</a>

  <a id="2128" class="Comment">------------------------------------------------------------------------</a>
  <a id="2203" class="Comment">-- Lexer: from Strings to Formats</a>

  <a id="2240" class="Comment">-- Lexing may fail. To have a useful error message, we defined the following</a>
  <a id="2319" class="Comment">-- enumerated type</a>

  <a id="2341" class="Keyword">data</a> <a id="Format.Error"></a><a id="2346" href="Text.Format.Generic.html#2346" class="Datatype">Error</a> <a id="2352" class="Symbol">:</a> <a id="2354" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2358" class="Keyword">where</a>
    <a id="Format.Error.UnexpectedEndOfString"></a><a id="2368" href="Text.Format.Generic.html#2368" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="2390" class="Symbol">:</a> <a id="2392" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2399" class="Symbol">→</a> <a id="2401" href="Text.Format.Generic.html#2346" class="Datatype">Error</a>
    <a id="2411" class="Comment">-- ^ expected a type declaration; found an empty string</a>
    <a id="Format.Error.InvalidType"></a><a id="2471" href="Text.Format.Generic.html#2471" class="InductiveConstructor">InvalidType</a> <a id="2483" class="Symbol">:</a> <a id="2485" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2492" class="Symbol">→</a> <a id="2494" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="2499" class="Symbol">→</a> <a id="2501" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2508" class="Symbol">→</a> <a id="2510" href="Text.Format.Generic.html#2346" class="Datatype">Error</a>
    <a id="2520" class="Comment">-- ^ invalid type declaration</a>
    <a id="2554" class="Comment">--   return a focus: prefix processed, character causing failure, rest</a>

  <a id="Format.lexer"></a><a id="2628" href="Text.Format.Generic.html#2628" class="Function">lexer</a> <a id="2634" class="Symbol">:</a> <a id="2636" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2643" class="Symbol">→</a> <a id="2645" href="Text.Format.Generic.html#2346" class="Datatype">Error</a> <a id="2651" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="2653" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2658" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a>
  <a id="2666" href="Text.Format.Generic.html#2628" class="Function">lexer</a> <a id="2672" href="Text.Format.Generic.html#2672" class="Bound">input</a> <a id="2678" class="Symbol">=</a> <a id="2680" href="Text.Format.Generic.html#3223" class="Function">loop</a> <a id="2685" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="2688" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="2691" class="Symbol">(</a><a id="2692" href="Data.String.Base.html#1531" class="Primitive">toList</a> <a id="2699" href="Text.Format.Generic.html#2672" class="Bound">input</a><a id="2704" class="Symbol">)</a> <a id="2706" class="Keyword">where</a>

    <a id="2717" class="Keyword">open</a> <a id="2722" href="Effect.Applicative.html#598" class="Module">RawApplicative</a> <a id="2737" class="Symbol">(</a><a id="2738" href="Data.Sum.Effectful.Left.html#939" class="Function">Sumₗ.applicative</a> <a id="2755" href="Text.Format.Generic.html#2346" class="Datatype">Error</a> <a id="2761" href="Level.html#512" class="Function">0ℓ</a><a id="2763" class="Symbol">)</a>

    <a id="2770" class="Comment">-- Type synonyms used locally to document the code</a>
    <a id="2825" href="Text.Format.Generic.html#2825" class="Function">RevWord</a> <a id="2833" class="Symbol">=</a> <a id="2835" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2840" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="2845" class="Comment">-- Mere characters accumulated so far</a>
    <a id="2887" href="Text.Format.Generic.html#2887" class="Function">Prefix</a>  <a id="2895" class="Symbol">=</a> <a id="2897" href="Text.Format.Generic.html#2825" class="Function">RevWord</a>   <a id="2907" class="Comment">-- Prefix of the input String already read</a>

    <a id="2955" href="Text.Format.Generic.html#2955" class="Function">toRevString</a> <a id="2967" class="Symbol">:</a> <a id="2969" href="Text.Format.Generic.html#2825" class="Function">RevWord</a> <a id="2977" class="Symbol">→</a> <a id="2979" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="2990" href="Text.Format.Generic.html#2955" class="Function">toRevString</a> <a id="3002" class="Symbol">=</a> <a id="3004" href="Data.String.Base.html#1564" class="Primitive">fromList</a> <a id="3013" href="Function.Base.html#3637" class="Function Operator">∘′</a> <a id="3016" href="Data.List.Base.html#6808" class="Function">reverse</a>

    <a id="3029" class="Comment">-- Push a Raw token if we have accumulated some mere characters</a>
    <a id="3097" href="Text.Format.Generic.html#3097" class="Function">push</a> <a id="3102" class="Symbol">:</a> <a id="3104" href="Text.Format.Generic.html#2825" class="Function">RevWord</a> <a id="3112" class="Symbol">→</a> <a id="3114" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3119" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a> <a id="3125" class="Symbol">→</a> <a id="3127" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3132" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a>
    <a id="3142" href="Text.Format.Generic.html#3097" class="Function">push</a> <a id="3147" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3150" href="Text.Format.Generic.html#3150" class="Bound">ks</a> <a id="3153" class="Symbol">=</a> <a id="3155" href="Text.Format.Generic.html#3150" class="Bound">ks</a>
    <a id="3162" href="Text.Format.Generic.html#3097" class="CatchallClause Function">push</a><a id="3166" class="CatchallClause"> </a><a id="3167" href="Text.Format.Generic.html#3167" class="CatchallClause Bound">cs</a><a id="3169" class="CatchallClause"> </a><a id="3170" href="Text.Format.Generic.html#3170" class="CatchallClause Bound">ks</a> <a id="3173" class="Symbol">=</a> <a id="3175" href="Text.Format.Generic.html#1702" class="InductiveConstructor">Raw</a> <a id="3179" class="Symbol">(</a><a id="3180" href="Text.Format.Generic.html#2955" class="Function">toRevString</a> <a id="3192" href="Text.Format.Generic.html#3167" class="Bound">cs</a><a id="3194" class="Symbol">)</a> <a id="3196" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3198" href="Text.Format.Generic.html#3170" class="Bound">ks</a>

    <a id="3206" class="Comment">-- Main loop</a>
    <a id="3223" href="Text.Format.Generic.html#3223" class="Function">loop</a> <a id="3228" class="Symbol">:</a> <a id="3230" href="Text.Format.Generic.html#2825" class="Function">RevWord</a> <a id="3238" class="Symbol">→</a> <a id="3240" href="Text.Format.Generic.html#2887" class="Function">Prefix</a> <a id="3247" class="Symbol">→</a> <a id="3249" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3254" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="3259" class="Symbol">→</a> <a id="3261" href="Text.Format.Generic.html#2346" class="Datatype">Error</a> <a id="3267" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="3269" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3274" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a>
    <a id="3284" href="Text.Format.Generic.html#3284" class="Function">type</a> <a id="3289" class="Symbol">:</a>           <a id="3301" href="Text.Format.Generic.html#2887" class="Function">Prefix</a> <a id="3308" class="Symbol">→</a> <a id="3310" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3315" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="3320" class="Symbol">→</a> <a id="3322" href="Text.Format.Generic.html#2346" class="Datatype">Error</a> <a id="3328" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="3330" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3335" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a>

    <a id="3346" href="Text.Format.Generic.html#3223" class="Function">loop</a> <a id="3351" href="Text.Format.Generic.html#3351" class="Bound">acc</a> <a id="3355" href="Text.Format.Generic.html#3355" class="Bound">bef</a> <a id="3359" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>               <a id="3376" class="Symbol">=</a> <a id="3378" href="Effect.Applicative.Indexed.html#999" class="Function">pure</a> <a id="3383" class="Symbol">(</a><a id="3384" href="Text.Format.Generic.html#3097" class="Function">push</a> <a id="3389" href="Text.Format.Generic.html#3351" class="Bound">acc</a> <a id="3393" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="3395" class="Symbol">)</a>
    <a id="3401" class="Comment">-- escaped &#39;%&#39; character: treat like a mere character</a>
    <a id="3459" href="Text.Format.Generic.html#3223" class="Function">loop</a> <a id="3464" href="Text.Format.Generic.html#3464" class="Bound">acc</a> <a id="3468" href="Text.Format.Generic.html#3468" class="Bound">bef</a> <a id="3472" class="Symbol">(</a><a id="3473" class="String">&#39;%&#39;</a> <a id="3477" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3479" class="String">&#39;%&#39;</a> <a id="3483" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3485" href="Text.Format.Generic.html#3485" class="Bound">cs</a><a id="3487" class="Symbol">)</a> <a id="3489" class="Symbol">=</a> <a id="3491" href="Text.Format.Generic.html#3223" class="Function">loop</a> <a id="3496" class="Symbol">(</a><a id="3497" class="String">&#39;%&#39;</a> <a id="3501" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3503" href="Text.Format.Generic.html#3464" class="Bound">acc</a><a id="3506" class="Symbol">)</a> <a id="3508" class="Symbol">(</a><a id="3509" class="String">&#39;%&#39;</a> <a id="3513" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3515" class="String">&#39;%&#39;</a> <a id="3519" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3521" href="Text.Format.Generic.html#3468" class="Bound">bef</a><a id="3524" class="Symbol">)</a> <a id="3526" href="Text.Format.Generic.html#3485" class="Bound">cs</a>
    <a id="3533" class="Comment">-- non escaped &#39;%&#39;: type declaration following</a>
    <a id="3584" href="Text.Format.Generic.html#3223" class="CatchallClause Function">loop</a><a id="3588" class="CatchallClause"> </a><a id="3589" href="Text.Format.Generic.html#3589" class="CatchallClause Bound">acc</a><a id="3592" class="CatchallClause"> </a><a id="3593" href="Text.Format.Generic.html#3593" class="CatchallClause Bound">bef</a><a id="3596" class="CatchallClause"> </a><a id="3597" class="CatchallClause Symbol">(</a><a id="3598" class="CatchallClause String">&#39;%&#39;</a><a id="3601" class="CatchallClause"> </a><a id="3602" href="Agda.Builtin.List.html#200" class="CatchallClause InductiveConstructor Operator">∷</a><a id="3603" class="CatchallClause"> </a><a id="3604" href="Text.Format.Generic.html#3604" class="CatchallClause Bound">cs</a><a id="3606" class="CatchallClause Symbol">)</a>       <a id="3614" class="Symbol">=</a> <a id="3616" href="Text.Format.Generic.html#3097" class="Function">push</a> <a id="3621" href="Text.Format.Generic.html#3589" class="Bound">acc</a> <a id="3625" href="Effect.Functor.html#606" class="Function Operator">&lt;$&gt;</a> <a id="3629" href="Text.Format.Generic.html#3284" class="Function">type</a> <a id="3634" class="Symbol">(</a><a id="3635" class="String">&#39;%&#39;</a> <a id="3639" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3641" href="Text.Format.Generic.html#3593" class="Bound">bef</a><a id="3644" class="Symbol">)</a> <a id="3646" href="Text.Format.Generic.html#3604" class="Bound">cs</a>
    <a id="3653" class="Comment">-- mere character: push onto the accumulator</a>
    <a id="3702" href="Text.Format.Generic.html#3223" class="Function">loop</a> <a id="3707" href="Text.Format.Generic.html#3707" class="Bound">acc</a> <a id="3711" href="Text.Format.Generic.html#3711" class="Bound">bef</a> <a id="3715" class="Symbol">(</a><a id="3716" href="Text.Format.Generic.html#3716" class="Bound">c</a> <a id="3718" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3720" href="Text.Format.Generic.html#3720" class="Bound">cs</a><a id="3722" class="Symbol">)</a>         <a id="3732" class="Symbol">=</a> <a id="3734" href="Text.Format.Generic.html#3223" class="Function">loop</a> <a id="3739" class="Symbol">(</a><a id="3740" href="Text.Format.Generic.html#3716" class="Bound">c</a> <a id="3742" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3744" href="Text.Format.Generic.html#3707" class="Bound">acc</a><a id="3747" class="Symbol">)</a> <a id="3749" class="Symbol">(</a><a id="3750" href="Text.Format.Generic.html#3716" class="Bound">c</a> <a id="3752" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3754" href="Text.Format.Generic.html#3711" class="Bound">bef</a><a id="3757" class="Symbol">)</a> <a id="3759" href="Text.Format.Generic.html#3720" class="Bound">cs</a>

    <a id="3767" href="Text.Format.Generic.html#3284" class="Function">type</a> <a id="3772" href="Text.Format.Generic.html#3772" class="Bound">bef</a> <a id="3776" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>       <a id="3785" class="Symbol">=</a> <a id="3787" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="3792" class="Symbol">(</a><a id="3793" href="Text.Format.Generic.html#2368" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="3815" href="Text.Format.Generic.html#2672" class="Bound">input</a><a id="3820" class="Symbol">)</a>
    <a id="3826" href="Text.Format.Generic.html#3284" class="Function">type</a> <a id="3831" href="Text.Format.Generic.html#3831" class="Bound">bef</a> <a id="3835" class="Symbol">(</a><a id="3836" href="Text.Format.Generic.html#3836" class="Bound">c</a> <a id="3838" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3840" href="Text.Format.Generic.html#3840" class="Bound">cs</a><a id="3842" class="Symbol">)</a> <a id="3844" class="Symbol">=</a> <a id="3846" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">_∷_</a> <a id="3850" href="Effect.Functor.html#606" class="Function Operator">&lt;$&gt;</a> <a id="3854" href="Text.Format.Generic.html#3898" class="Function">chunk</a> <a id="3860" href="Text.Format.Generic.html#3836" class="Bound">c</a> <a id="3862" href="Effect.Applicative.Indexed.html#1030" class="Function Operator">⊛</a> <a id="3864" href="Text.Format.Generic.html#3223" class="Function">loop</a> <a id="3869" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3872" class="Symbol">(</a><a id="3873" href="Text.Format.Generic.html#3836" class="Bound">c</a> <a id="3875" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3877" href="Text.Format.Generic.html#3831" class="Bound">bef</a><a id="3880" class="Symbol">)</a> <a id="3882" href="Text.Format.Generic.html#3840" class="Bound">cs</a> <a id="3885" class="Keyword">where</a>

      <a id="3898" href="Text.Format.Generic.html#3898" class="Function">chunk</a> <a id="3904" class="Symbol">:</a> <a id="3906" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="3911" class="Symbol">→</a> <a id="3913" href="Text.Format.Generic.html#2346" class="Datatype">Error</a> <a id="3919" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="3921" href="Text.Format.Generic.html#1653" class="Datatype">Chunk</a>
      <a id="3933" href="Text.Format.Generic.html#3898" class="Function">chunk</a> <a id="3939" href="Text.Format.Generic.html#3939" class="Bound">c</a> <a id="3941" class="Symbol">=</a>
        <a id="3951" href="Function.Base.html#3973" class="Function Operator">case</a> <a id="3956" href="Text.Format.Generic.html#1020" class="Field">lexArg</a> <a id="3963" href="Text.Format.Generic.html#3939" class="Bound">c</a> <a id="3965" href="Function.Base.html#3973" class="Function Operator">of</a> <a id="3968" class="Symbol">λ</a> <a id="3970" class="Keyword">where</a>
          <a id="3986" class="Symbol">(</a><a id="3987" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3992" href="Text.Format.Generic.html#3992" class="Bound">ch</a><a id="3994" class="Symbol">)</a> <a id="3996" class="Symbol">→</a> <a id="3998" href="Effect.Applicative.Indexed.html#999" class="Function">pure</a> <a id="4003" class="Symbol">(</a><a id="4004" href="Text.Format.Generic.html#1675" class="InductiveConstructor">Arg</a> <a id="4008" href="Text.Format.Generic.html#3992" class="Bound">ch</a><a id="4010" class="Symbol">)</a>
          <a id="4022" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>   <a id="4032" class="Symbol">→</a>
            <a id="4046" href="Function.Strict.html#1664" class="Function">force′</a> <a id="4053" class="Symbol">(</a><a id="4054" href="Text.Format.Generic.html#2955" class="Function">toRevString</a> <a id="4066" href="Text.Format.Generic.html#3831" class="Bound">bef</a><a id="4069" class="Symbol">)</a> <a id="4071" class="Symbol">λ</a> <a id="4073" href="Text.Format.Generic.html#4073" class="Bound">prefix</a> <a id="4080" class="Symbol">→</a>
            <a id="4094" href="Function.Strict.html#1664" class="Function">force′</a> <a id="4101" class="Symbol">(</a><a id="4102" href="Data.String.Base.html#1564" class="Primitive">fromList</a> <a id="4111" href="Text.Format.Generic.html#3840" class="Bound">cs</a><a id="4113" class="Symbol">)</a>     <a id="4119" class="Symbol">λ</a> <a id="4121" href="Text.Format.Generic.html#4121" class="Bound">suffix</a> <a id="4128" class="Symbol">→</a>
            <a id="4142" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="4147" class="Symbol">(</a><a id="4148" href="Text.Format.Generic.html#2471" class="InductiveConstructor">InvalidType</a> <a id="4160" href="Text.Format.Generic.html#4073" class="Bound">prefix</a> <a id="4167" href="Text.Format.Generic.html#3939" class="Bound">c</a> <a id="4169" href="Text.Format.Generic.html#4121" class="Bound">suffix</a><a id="4175" class="Symbol">)</a>
</pre></body></html>